<!doctype html>
<html>
	<head>
		<title>CCMT-2021 Cutoff</title>
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<style type="text/css">
			#cutoff_table {
				border: 1px solid black;
			}
			#cutoff_table td, #cutoff_table th {
				border: 1px solid black;
				padding: 5px;
			}
			.default{
				background: #ffffff !important;
			}
			.grey{
				background: #dfdfdf !important;
			}
			.good{
				background: #cfffcf !important;
			}
			.bad{
				background: #ffcfcf !important;
			}
			.default td, .default th{
				background: #ffffff
			}
			.grey td, .grey th {
				background: #dfdfdf
			}
			.good td, .good th{
				background: #cfffcf
			}
			.bad td, .bad th{
				background: #ffcfcf
			}

			#totalCount {
				font-weight: bold;
			}
			#goodCount {
				font-weight: bold;
				color: #3faf3f;
			}
			#badCount {
				font-weight: bold;
				color: #af3f3f;
			}
			#zeroCount {
				font-weight: bold;
				color: #9f9f9f;
			}
		</style>
		<script type="text/javascript" src="./data.js"></script>
	</head>

	<body>
		<h1> CCMT-2021 GATE Score cutoffs </h1>

		Round:
		<select id="round">
			<option value="1">Round 1</option>
			<option value="2">Round 2</option>
			<option value="3">Round 3</option>
		</select> <br>

		GATE Score: <input type="number" id="gate_score" value="0"> <br>

		Category:
		<select id="category">
			<option value="0">GEN (Open)</option>
			<option value="1">GEN-PwD (Open-PwD)</option>
			<option value="2">EWS</option>
			<option value="3">EWS-PwD</option>
			<option value="4">OBC-NCL</option>
			<option value="5">OBC-NCL-PwD</option>
			<option value="6">SC</option>
			<option value="7">SC-PwD</option>
			<option value="8">ST</option>
			<option value="9">ST-PwD</option>
		</select> <br>

		Show:
		<select id="table_view">
			<option value="0">All Courses</option>
			<option value="2">Accepting Courses</option>
			<option value="1">Accepting Courses (include zero seats)</option>
		</select> <br><br>

		Sort by:
		<select id="sort_by">
			<option value="0">Institute Name</option>
			<option value="2">Program (Course) Name</option>
			<option value="4">MAX cutoff</option>
			<option value="6">MIN cutoff</option>
			<option value="8">Average cutoff</option>
		</select> <br>
		<label><input type="radio" name="sortOrder" id="order_asc" checked> Ascending</label> &nbsp;
		<label><input type="radio" name="sortOrder" id="order_desc"> Descending</label> <br><br>

		<button id="go" onclick="parseTable()">UPDATE</button> <br><br>

		Accepting Courses: <span id="goodCount"></span> <br>
		Rejecting Courses: <span id="badCount"></span> <br>
		Zero Seats: <span id="zeroCount"></span> <br>
		Total Courses: <span id="totalCount"></span> <br><br>

		<table id="hidden_table" style="display: none; margin: -9999px;">
			<tr class="grey">
				<th rowspan="2">Institute Name</th>
				<th rowspan="2">Program Name</th>
				<th rowspan="2">Group Id</th>
				<th colspan="2">GEN</th>
				<th colspan="2">GEN-PwD</th>
				<th colspan="2">EWS</th>
				<th colspan="2">EWS-PwD</th>
				<th colspan="2">OBC-NCL</th>
				<th colspan="2">OBC-NCL-PwD</th>
				<th colspan="2">SC</th>
				<th colspan="2">SC-PwD</th>
				<th colspan="2">ST</th>
				<th colspan="2">ST-PwD</th>
			</tr>
			<tr class="grey">
				<th>MAX</th>
				<th>MIN</th>
				<th>MAX</th>
				<th>MIN</th>
				<th>MAX</th>
				<th>MIN</th>
				<th>MAX</th>
				<th>MIN</th>
				<th>MAX</th>
				<th>MIN</th>
				<th>MAX</th>
				<th>MIN</th>
				<th>MAX</th>
				<th>MIN</th>
				<th>MAX</th>
				<th>MIN</th>
				<th>MAX</th>
				<th>MIN</th>
				<th>MAX</th>
				<th>MIN</th>
			</tr>
		</table>

		<table id="cutoff_table"></table>

		<script type="text/javascript">
			var tableHeader = document.getElementById("hidden_table").children;

			function addCell (tr, str, classList) {
				var td = document.createElement("td");
				var text = document.createTextNode (str);
				if (classList) td.classList += " " + classList;
				td.appendChild(text);
				tr.appendChild(td);
			}
			function insSort(d, cmp) {
				for (var i = 1; i < d.length; ++i) {
					for (var j = i; j > 0; --j) {
						if (cmp(d[j-1], d[j]) > 0) {
							var temp = d[j];
							d[j] = d[j-1];
							d[j-1] = temp;
						}
						else break;
					}
				}
			}
			function sortData(data, sortBy, scoreindex) {
				switch (sortBy) {
					case 0: insSort(data, function (a, b) {return (a[0] <= b[0]) ? -1 : 1});
						break;
					case 1: insSort(data, function (a, b) {return (b[0] <= a[0]) ? -1 : 1});
						break;
					case 2: insSort(data, function (a, b) {return (a[1] <= b[1]) ? -1 : 1});
						break;
					case 3: insSort(data, function (a, b) {return (b[1] <= a[1]) ? -1 : 1});
						break;
					case 4: insSort(data, function (a, b) {return a[scoreindex] - b[scoreindex]});
						break;
					case 5: insSort(data, function (a, b) {return b[scoreindex] - a[scoreindex]});
						break;
					case 6: insSort(data, function (a, b) {return a[scoreindex+1] - b[scoreindex+1]});
						break;
					case 7: insSort(data, function (a, b) {return b[scoreindex+1] - a[scoreindex+1]});
						break;
					case 8: insSort(data, function (a, b) {return (a[scoreindex]+a[scoreindex+1])/2 - (b[scoreindex+1]+b[scoreindex])/2});
						break;
					case 9: insSort(data, function (a, b) {return (b[scoreindex]+b[scoreindex+1])/2 - (a[scoreindex+1]+a[scoreindex])/2});
						break;
				}
				return data;
			}
			function parseTable() {
				var round = document.getElementById ("round").value;
				var data;
				var gate_score = parseInt(document.getElementById ("gate_score").value);
				if (!gate_score) gate_score = 0;
				var category = 2 * parseInt(document.getElementById ("category").value);
				var tableView = parseInt(document.getElementById ("table_view").value);
				var sortBy = parseInt(document.getElementById ("sort_by").value);
				sortBy = (document.getElementById ("order_asc").checked) ? sortBy : (sortBy+1);

				var table = document.getElementById ("cutoff_table");
				table.innerHTML = document.getElementById("hidden_table").innerHTML;

				if (round === '1')
					data = scores.round1;
				else if (round === '2')
					data = scores.round2;
				else if (round === '3')
					data = scores.round3;

				var goodCount = 0, zeroCount = 0, totalCount = 0;

				data = sortData(data, sortBy, category+3);

				for (var i = 0; i < data.length; ++i) {
					var s = data[i];
					var scoreCellNumber = 0, row = document.createElement("tr");
					for (var j = 0; j < s.length; ++j) {
						if (j < 2)
							addCell (row, s[j]);
						else if (j === 2)
							addCell (row, s[j], "default");
						else if (j > 2) {
							if (scoreCellNumber === category || scoreCellNumber === category+1) {
								if (s[j] === 0) {
									addCell(row, s[j], "grey");
									row.classList += " grey";
									if (scoreCellNumber === category) ++zeroCount;
									if (tableView >= 2) {
										row = null;
										break;
									}
								}
								else if (gate_score >= s[j]) {
									addCell(row, s[j], "good");
									row.classList += " good";
									if (scoreCellNumber === category+1) ++goodCount;
								}
								else if (gate_score < s[j]) {
									addCell(row, s[j], "bad");
									if (scoreCellNumber === category+1) {
										row.classList += " bad";
										if (tableView >= 1) {
											row = null;
											break;
										}
									}
								}
							}
							else addCell(row, s[j], "default");

							++scoreCellNumber;
						}
						if (j === s.length - 1) {
							++totalCount;
							table.appendChild(row);
						}
					}
				}
				document.getElementById("totalCount").innerHTML = i;
				document.getElementById("goodCount").innerHTML = goodCount;
				document.getElementById("badCount").innerHTML = i - goodCount - zeroCount;
				document.getElementById("zeroCount").innerHTML = zeroCount;
			}
			document.body.onload = function() {
				sortData(scores.round1, 2);
				sortData(scores.round2, 2);
				sortData(scores.round2, 0);
				sortData(scores.round3, 2);
				sortData(scores.round3, 0);

				parseTable();
			}
		</script>
	</body>
</html>
		
