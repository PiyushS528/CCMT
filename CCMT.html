<!doctype html>
<html lang="en">
	<head>
		<title>CCMT Cutoff Viewer Tool</title>

		<meta name="keywords" content="CCMT, cutoff, tool, viewer, previous year, GATE, gate score">
		<meta name="description" content="View CCMT GATE score cutoffs of previous years in a neat tabular form, with options to sort and highlight all eligible courses.">
		<meta property="og:title" content="CCMT Cutoff Viewer Tool">
		<meta property="og:description" content="View CCMT GATE score cutoffs of previous years in a neat tabular form, with options to sort and highlight all eligible courses.">
		<meta property="og:url" content="https://piyushs528.github.io/CCMT/CCMT.html">
		<meta property="og:image" content="https://piyushs528.github.io/CCMT/thumb.png">

		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<link rel="icon" type="image/x-icon" href="./favicon.ico">

		<style type="text/css">
			@font-face {
				font-family: autoradiographic;
				src: url("./autoradiographic/autoradiographic rg.ttf");
			}
			@font-face {
				font-family: autoradiographic;
				font-style: italic;
				src: url("./autoradiographic/autoradiographic rg it.ttf");
			}
			html, body, input, button, select {
				font-family: autoradiographic, sans-serif;
			}
			html, body {
				background: #cfdfef;
			}
			fieldset {
				border: 1px dashed #000000;
				min-width: 32em;
			}
			select, input[type="number"] {
				height: 2em;
				margin: 0.2em 0 0 0;
			}
			select {
				cursor: pointer;
			}
			.curr {
				border: 3px double #6f6f6f;
				border-width: 3px 0;
				color: #6f6f6f;
				font-size: 0.7em;
				margin-left: 0.5em;
				padding: 0 0.5em;
			}
			label {
				border: 1px solid rgba(0, 0, 0, 0.5);
				border-radius: 5em;
				border-width: 0 0 1px 1px;
				cursor: pointer;
				line-height: 2em;
				padding: 0.2em 1em;
			}
			button {
				background: #efefef;
				border: 1px solid #000000;
				border-radius: 5px;
				color: #000000;
				cursor: pointer;
				padding: 0.5em 1em;
			}
			button#go {
				padding: 0.5em 2em !important;
			}
			button.pagenav {
				padding: 0.7em 1.4em;
			}
			button:hover {
				background: #cfeff7;
			}
			button:active {
				background: #2fcfff;
			}
			button[disabled], button[disabled]:hover, button[disabled]:active {
				background: #cfcfcf;
				color: #7f7f7f;
				border-color: #7f7f7f;
			}
			
			#cutoff_table {
				border: 1px solid black;
				font-size: 0.9em;
				min-width: 95%;
			}
			#cutoff_table td, #cutoff_table th {
				border: 1px solid black;
				border-width: 0 1px 1px 0;
				padding: 5px;
			}
			.default{
				background: #ffffff !important;
			}
			.grey{
				background: url("./null-hatch.png") #cfcfcf !important;
			}
			.good{
				background: #cfffcf !important;
			}
			.bad{
				background: #efafaf !important;
			}
			.default td, .default th{
				background: #ffffff;
			}
			.grey td, .grey th {
				background: url("./null-hatch.png") #cfcfcf;
			}
			.good td, .good th{
				background: #cfffcf;
			}
			.bad td, .bad th{
				background: #efafaf;
			}

			#totalCount {
				font-weight: bold;
			}
			#goodCount {
				font-weight: bold;
				color: #3faf3f;
			}
			#badCount {
				font-weight: bold;
				color: #af3f3f;
			}
			#zeroCount {
				font-weight: bold;
				color: #6f6f6f;
			}
		</style>
		<script type="text/javascript" src="./data.js"></script>
	</head>

	<body onload="loadInitTable()">
		<h1> CCMT Cutoff Viewer Tool </h1>

		<em style="font-size: 0.8em">
			Last Updated: 20-Jun-2022 <br>
			(Source: <a href="https://ccmt.admissions.nic.in/or-cr/" target="_blank">https://ccmt.admissions.nic.in/or-cr/</a> (new tab) )
		</em> <br><br>

		<fieldset id="fields" onchange="console.log('changed')">
			Year:
			<select id="ccmt_year" onchange="yearChanged()">
				<option value="year2022" selected>2022</option>
				<option value="year2021">2021</option>
				<option value="year2020">2020</option>
				<option value="year2019">2019</option>
			</select>
			<span id="curr_year" class="curr"></span> <br>

			Round:
			<select id="ccmt_round" onchange="highlightUpdateButton()">
				<option value="Round 1" selected>Round 1</option>
			</select>
			<span id="curr_round" class="curr"></span> <br><br>

			GATE Score:
			<input type="number" id="gate_score" value="0" onchange="highlightUpdateButton()" />
			<span id="curr_score" class="curr"></span> <br>

			Category:
			<select id="category" onchange="highlightUpdateButton()">
				<option value="0" selected>GEN (Open)</option>
				<option value="1">GEN-PwD (Open-PwD)</option>
				<option value="2">EWS</option>
				<option value="3">EWS-PwD</option>
				<option value="4">OBC-NCL</option>
				<option value="5">OBC-NCL-PwD</option>
				<option value="6">SC</option>
				<option value="7">SC-PwD</option>
				<option value="8">ST</option>
				<option value="9">ST-PwD</option>
			</select>
			<span id="curr_cat" class="curr"></span> <br>

			Show:
			<select id="table_view" onchange="highlightUpdateButton()">
				<option value="0" selected>All Courses</option>
				<option value="2">Accepting Courses</option>
				<option value="1">Accepting Courses (include zero seats)</option>
			</select>
			<span id="curr_view" class="curr"></span> <br><br>

			Sort by:
			<select id="sort_by" onchange="highlightUpdateButton()">
				<option value="0" selected>Institute Name</option>
				<option value="2">Program (Course) Name</option>
				<option value="4">MAX cutoff</option>
				<option value="6">MIN cutoff</option>
				<option value="8">Average cutoff</option>
			</select>
			<span id="curr_sort" class="curr"></span> <br>

			<label><input type="radio" name="sortOrder" id="order_asc" checked onchange="highlightUpdateButton()"> Ascending</label> &nbsp;
			<label><input type="radio" name="sortOrder" id="order_desc" onchange="highlightUpdateButton()"> Descending</label>
			<span id="curr_order" class="curr"></span> <br><br>

			<button id="go" onclick="parseTable()">UPDATE</button>
		</fieldset> <br>

		Accepting Courses: <span id="goodCount"></span> <br>
		Rejecting Courses: <span id="badCount"></span> <br>
		Zero Seats: <span id="zeroCount"></span> <br>
		Total Courses: <span id="totalCount"></span> <br><br>

		(Note: MAX and MIN values indicate GATE scores) <br><br>

		Rows per page:
		<select id="rowsperpage" onchange="updatePage(0)">
			<option value="0">ALL</option>
			<option value="10">10</option>
			<option value="25" selected>25</option>
			<option value="50">50</option>
			<option value="100">100</option>
		</select> <br>

		Showing rows: <span id="rowsrange">-</span> &nbsp;

		<div id="page_buttons">
			<button id="prev_page" class="pagenav" onclick="updatePage(-2)" disabled><b>&lt;</b></button>
			<span id="page_number_row">
				<button name="page_number" disabled>1</button>
			</span>
			<button id="next_page" class="pagenav" onclick="updatePage(-1)" disabled><b>&gt;</b></button>
		</div> <br>

		<table id="cutoff_table" cellspacing="0"></table> <br>

		<button onclick="scrollToTop()" style="padding: 3em">^ BACK TO TOP ^</button> <br><br>

		<script type="text/javascript">
			var inputfield = {
				year: document.getElementById("ccmt_year"),
				round: document.getElementById("ccmt_round"),
				score: document.getElementById("gate_score"),
				category: document.getElementById("category"),
				showcourses: document.getElementById("table_view"),
				sortby: document.getElementById("sort_by"),
				orderasc: document.getElementById("order_asc"),
				rowsperpage: document.getElementById("rowsperpage")
			};
			var state = {
				year: 0,
				round: "",
				score: 0,
				category: "",
				showcourses: 0,
				sortby: 0,

				rowsperpage: 0,
				currpage: 0,

				tabledata: [],
				othertabledata: []
			};
			function updateInputState() {
				state.year = inputfield.year.value;
				state.round = inputfield.round.value;
				state.score = parseInt(inputfield.score.value);
				if (!state.score) state.score = 0;

				state.category = parseInt(inputfield.category.value);
				state.showcourses = parseInt(inputfield.showcourses.value);
				state.sortby = parseInt(inputfield.sortby.value);
				if (!inputfield.orderasc.checked) ++state.sortby;

				state.rowsperpage = parseInt(inputfield.rowsperpage.value);
				state.currpage = 0;

				state.tabledata = [];
				state.othertabledata = [];
			}
			function highlightUpdateButton (disable) {
				if (disable)
					document.getElementById("go").style.outline = "0";
				else
					document.getElementById("go").style.outline = "3px solid #df5f5f";
			}
			function yearChanged() {		// Update 'round' selection box if 'year' selection is changed
				inputfield.round.innerHTML = "";
				for (var r in scores[inputfield.year.value]) {
					var option = document.createElement("option");
					option.setAttribute("value", r);
					var text = document.createTextNode(r);
					option.appendChild(text);
					inputfield.round.appendChild(option);
				}
				highlightUpdateButton();
			}
			function addCell (tr, str, classList) {		// append <td class=(classList)>(str)</td> in tr table row
				var td = document.createElement("td");
				var text = document.createTextNode (str);
				if (classList) td.className += " "+classList;
				td.appendChild(text);
				tr.appendChild(td);
				return td;
			}
			function addHeader (tr, str, classList) {		// append <th class=(classList)>(str)</th> in tr table row
				var th = document.createElement("th");
				var text = document.createTextNode (str);
				if (classList) th.className += " "+classList;
				th.appendChild(text);
				tr.appendChild(th);
				return th;
			}
			function addTableHeader (table) {
				var tr, th;

				var tr = document.createElement ("tr");
				tr.className += " grey";

				th = addHeader(tr, "Sr. No."); th.setAttribute("rowspan", 2);
				th = addHeader(tr, "Institute Name"); th.setAttribute("rowspan", 2);
				th = addHeader(tr, "Program Name"); th.setAttribute("rowspan", 2);
				th = addHeader(tr, "Group Id"); th.setAttribute("rowspan", 2);
				th = addHeader(tr, "GEN"); th.setAttribute("colspan", 2);
				th = addHeader(tr, "GEN-PwD"); th.setAttribute("colspan", 2);
				th = addHeader(tr, "EWS"); th.setAttribute("colspan", 2);
				th = addHeader(tr, "EWS-PwD"); th.setAttribute("colspan", 2);
				th = addHeader(tr, "OBC-NCL"); th.setAttribute("colspan", 2);
				th = addHeader(tr, "OBC-NCL-PwD"); th.setAttribute("colspan", 2);
				th = addHeader(tr, "SC"); th.setAttribute("colspan", 2);
				th = addHeader(tr, "SC-PwD"); th.setAttribute("colspan", 2);
				th = addHeader(tr, "ST"); th.setAttribute("colspan", 2);
				th = addHeader(tr, "ST-PwD"); th.setAttribute("colspan", 2);
				table.appendChild(tr);

				var tr = document.createElement ("tr");
				tr.className += " grey";

				for (var i = 0; i < 10; ++i) {
					addHeader(tr, "MAX");
					addHeader(tr, "MIN");
				}
				table.appendChild(tr);
			}
			function insSort(d, cmp) {		// insertion sort with cmp() as comparing function
				for (var i = 1; i < d.length; ++i) {
					for (var j = i; j > 0; --j) {
						if (cmp(d[j-1], d[j]) > 0) {
							var temp = d[j];
							d[j] = d[j-1];
							d[j-1] = temp;
						}
						else break;
					}
				}
			}
			function sortData(data, sortType, scoreindex) {		// scoreindex = starting index of score within data row (general category)
				switch (sortType) {
					case 0: insSort(data, function (a, b) {return (a[0] <= b[0]) ? -1 : 1});	// Ascending institute name
						break;
					case 1: insSort(data, function (a, b) {return (b[0] <= a[0]) ? -1 : 1});	// Descending institute name
						break;
					case 2: insSort(data, function (a, b) {return (a[1] <= b[1]) ? -1 : 1});	// Ascending program name
						break;
					case 3: insSort(data, function (a, b) {return (b[1] <= a[1]) ? -1 : 1});	// Descending program name
						break;
					case 4: insSort(data, function (a, b) {return a[scoreindex] - b[scoreindex]});	// Ascending MAX score
						break;
					case 5: insSort(data, function (a, b) {return b[scoreindex] - a[scoreindex]});	// Descending MAX score
						break;
					case 6: insSort(data, function (a, b) {return a[scoreindex+1] - b[scoreindex+1]});	// Ascending MIN score
						break;
					case 7: insSort(data, function (a, b) {return b[scoreindex+1] - a[scoreindex+1]});	// Descending MIN score
						break;
					case 8: insSort(data, function (a, b) {return (a[scoreindex]+a[scoreindex+1])/2 - (b[scoreindex+1]+b[scoreindex])/2});	// Ascending (MAX+MIN)/2 (average)
						break;
					case 9: insSort(data, function (a, b) {return (b[scoreindex]+b[scoreindex+1])/2 - (a[scoreindex+1]+a[scoreindex])/2});	// Descending (MAX+MIN)/2 (average)
						break;
				}
				return data;
			}
			function displayTableRows (startingrow, totalrows) {
				var table = document.getElementById ("cutoff_table");

				while (table.firstChild)
					table.removeChild (table.lastChild);	// clears the table
				addTableHeader(table);

				var lastrow = startingrow + totalrows - 1;
				if ((lastrow > state.tabledata.length - 1) || (totalrows === 0))
					lastrow = state.tabledata.length - 1;

				for (var i = startingrow; i <= lastrow; ++i) {
					var row = document.createElement("tr");
					row.className += state.othertabledata[i][0];
					addCell(row, state.tabledata[i][0]);
					addCell(row, state.tabledata[i][1]);
					addCell(row, state.tabledata[i][2]);
					addCell(row, state.tabledata[i][3], "default");
					for (var j = 4; j < state.tabledata[i].length; ++j) {
						var colorcode = state.othertabledata[i][j-3];
						var cellclass;
						switch (colorcode) {
							case 0: cellclass = "default"; break;
							case 1: cellclass = "good"; break;
							case 2: cellclass = "bad"; break;
							case 3: cellclass = "grey"; break;
						}
						addCell(row, state.tabledata[i][j], cellclass);
					}
					table.appendChild (row);
				}
				document.getElementById ("rowsrange").innerHTML = ((state.tabledata.length === 0) ? "0-" : (startingrow + 1) + "-");
				document.getElementById ("rowsrange").innerHTML += (lastrow + 1) + " out of " +  state.tabledata.length;
			}
			function updatePage (index) {
				// -2: previous page;
				// -1: next page;
				// 0,1,2,... : page 0,1,2,....

				state.rowsperpage = parseInt(inputfield.rowsperpage.value);
				var totalPages = ((state.rowsperpage === 0) ? 1 : Math.ceil(state.tabledata.length / state.rowsperpage));
				if (totalPages === 0) totalPages = 1;

				if (index === -2) {
					if (state.currpage > 0) --state.currpage;
					else return;
				}
				else if (index === -1) {
					if (state.currpage < totalPages-1) ++state.currpage;
					else return;
				}
				else if (index < -2) return;
				else state.currpage = index;

				if (state.currpage === 0)
					document.getElementById("prev_page").setAttribute("disabled", "disabled");
				else
					document.getElementById("prev_page").removeAttribute("disabled");
				if (state.currpage === totalPages-1)
					document.getElementById("next_page").setAttribute("disabled", "disabled");
				else
					document.getElementById("next_page").removeAttribute("disabled");

				var pageNumbers = document.getElementById ("page_number_row");
				while (pageNumbers.firstChild)
					pageNumbers.removeChild (pageNumbers.lastChild);	// clears all page number buttons

				for (var i = 0; i < totalPages; ++i) {
					var button = document.createElement ("button");
					button.setAttribute("onclick", "updatePage(" + i + ")");
					button.innerHTML = i+1;
					if (state.currpage === i)
						button.setAttribute ("disabled", "disabled");
					pageNumbers.appendChild (button);
				}
				displayTableRows(state.currpage * state.rowsperpage, state.rowsperpage);
			}
			function parseTable() {
				highlightUpdateButton(true);
				updateInputState();
				var categoryOffset = 2 * state.category;

				var data = scores[inputfield.year.value][inputfield.round.value];
				data = sortData(data, state.sortby, categoryOffset+3);

				var goodCount = 0, zeroCount = 0, totalCount = 0;

				for (var i = 0; i < data.length; ++i) {
					var s = data[i];
					var scoreCellNumber = 0;
					var row = [], classesData = [];
					row.push(i+1);

					for (var j = 0; j < s.length; ++j) {
						if (j <= 2)
							row.push(s[j]);
						else if (j > 2) {
							if (scoreCellNumber === categoryOffset || scoreCellNumber === categoryOffset+1) {
								if (s[j] === 0) {
									if (scoreCellNumber === categoryOffset) {
										classesData.unshift(" grey");
										++zeroCount;
									}
									if (state.showcourses >= 2) {
										row = null;
										break;
									}
									row.push(s[j]);
									classesData.push(3);
								}
								else if (state.score >= s[j]) {
									if (scoreCellNumber === categoryOffset+1) {
										classesData.unshift(" good");
										++goodCount;
									}
									row.push(s[j]);
									classesData.push(1);
								}
								else if (state.score < s[j]) {
									if (scoreCellNumber === categoryOffset+1) {
										classesData.unshift(" bad");
										if (state.showcourses >= 1) {
											row = null;
											break;
										}
									}
									row.push(s[j]);
									classesData.push(2);
								}
							}
							else {
								row.push(s[j]);
								classesData.push(0);
							}

							++scoreCellNumber;
						}
						if (j === s.length - 1) {
							++totalCount;
							state.tabledata.push(row);
							state.othertabledata.push(classesData);
						}
					}
				}
				updatePage(0);

				document.getElementById("totalCount").innerHTML = i;
				document.getElementById("goodCount").innerHTML = goodCount;
				document.getElementById("badCount").innerHTML = i - goodCount - zeroCount;
				document.getElementById("zeroCount").innerHTML = zeroCount;

				document.getElementById("curr_year").innerHTML = inputfield.year.children[inputfield.year.selectedIndex].innerHTML;
				document.getElementById("curr_round").innerHTML = inputfield.round.children[inputfield.round.selectedIndex].innerHTML;
				document.getElementById("curr_score").innerHTML = state.score;
				document.getElementById("curr_cat").innerHTML = inputfield.category.children[inputfield.category.selectedIndex].innerHTML;
				document.getElementById("curr_view").innerHTML = inputfield.showcourses.children[inputfield.showcourses.selectedIndex].innerHTML;
				document.getElementById("curr_sort").innerHTML = inputfield.sortby.children[inputfield.sortby.selectedIndex].innerHTML;
				document.getElementById("curr_order").innerHTML = (inputfield.orderasc.checked ? "Ascending" : "Descending");
			}
			function scrollToTop() {
				inputfield.rowsperpage.scrollIntoView();
			}
			function loadInitTable() {		// Group by institute name, sort by program name for every list
				for (var year in scores) {
					for (var round in scores[year]) {
						sortData(scores[year][round], 2);
						sortData(scores[year][round], 0);
					}
				}
				parseTable();
			}
		</script>
	</body>
</html>
		
